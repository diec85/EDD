# 1. Instal·lació de Gradle

Gradle es troba als dipòsits de programari d'Ubuntu, pel que podem instal·lar-lo amb apt:

```
$ sudo apt-get update
...
$ sudo apt-get install gradle
```

Com veurem, el paquet arrossega moltes dependències. Diem que sí a tot, i una vegada instal·lat, podem comprovar la versió amb:

```
------------------------------------------------------------
## Gradle 5.1
------------------------------------------------------------

Build time:   2019-01-02 18:57:47 UTC
Revision:     d09c2e354576ac41078c322815cc6db2b66d976e

Kotlin DSL:   1.1.0
Kotlin:       1.3.11
Groovy:       2.5.4
Ant:          Apache Ant(TM) version 1.9.13 compiled on July 10 2018
JVM:          11.0.5 (Private Build 11.0.5+10-post-Ubuntu-0ubuntu1.118.04)
OS:           Linux 4.15.0-72-generic amd64
```

## 2. Exemple amb Gradle

Anem a veure com fariem amb Gradle el projecte per a un Hola Món típic.

### 2.1. Creació d'un projecte

Per tal de crear un projecte nou en Gradle, farem ús de l'ordre gradle init. Per a això, ens ubiquem en una carpeta buida, invoquem gradle init i anem seguint l'assistent:

```
$ gradle init

Select type of project to generate:
  1: basic
  2: groovy-application
  3: groovy-library
  4: java-application
  5: java-library
  6: kotlin-application
  7: kotlin-library
  8: scala-library
Enter selection (default: basic) [1..8] 4

Select build script DSL:
  1: groovy
  2: kotlin
Enter selection (default: groovy) [1..2] 1

Select test framework:
  1: junit
  2: testng
  3: spock
Enter selection (default: junit) [1..3] 1

Project name (default: gradle): helloGradle
Source package (default: helloGradle): com.ieseljust.edd

BUILD SUCCESSFUL in 17s
2 actionable tasks: 2 executed
```

Com veiem, se'ns executa un assistent que ens demana el tipus de projecte (java application), el llenguatge per definir el projecte (groovy), el framework de test (junit) i el nom del projecte (helloGradle).


Es quedara està estructura:

```
.
|-- build.gradle
|-- gradle
|   `-- wrapper
|       |-- gradle-wrapper.jar
|       `-- gradle-wrapper.properties
|-- gradlew
|-- gradlew.bat
|-- settings.gradle
|-- src
|   |-- main
|   |   |-- java
|   |   |   `-- com
|   |   |       `-- ieseljust
|   |   |           `-- edd
|   |   |               `-- App.java
|   |   `-- resources
|   `-- test
|       |-- java
|       |   `-- com
|       |       `-- ieseljust
|       |           `-- edd
|       |               `-- AppTest.java
|       `-- resources
`-- wrapper
    |-- gradle-wrapper.jar
    `-- gradle-wrapper.properties
```

Ara posarem el Calcula.java i el Calculadora.java en un nou directori anomenat calc que pengara de edd. Quedara d'aquesta manera:


```
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
├── settings.gradle
└── src
    ├── main
    │   ├── java
    │   │   └── com
    │   │       └── ieseljust
    │   │           └── edd
    │   │               ├── App.java
    │   │               └── calc
    │   │                   ├── Calculadora.java
    │   │                   └── Calcula.java
    │   └── resources
    └── test
        ├── java
        │   └── com
        │       └── ieseljust
        │           └── edd
        │               └── AppTest.java
```

Com que de moment, no necessitem generar tests, podem esborrar els fitxers d'aquesta carpeta amb rm -r src/test.

El contingut del fitxer App.java és una altra variant de l'Hola Món:

```
/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.ieseljust.edd;

public class App {
    public String getGreeting() {
        return "Hello world.";
    }

    public static void main(String[] args) {
        System.out.println(new App().getGreeting());
    }
}

Veiem ara el contingut del fitxer de projecte build.gradle (llevem els comentaris per a què es llisca millor):

plugins {
    id 'java'
    id 'application'
}

repositories {
    jcenter()
}

dependencies {
    implementation 'com.google.guava:guava:26.0-jre'
    testImplementation 'junit:junit:4.12'
}

mainClassName = 'com.ieseljust.edd.App'
```

Nosaltres modificarem el mainClassName perquè quede d'aquesta manera per poder executaro despres:

```
mainClassName = 'com.ieseljust.edd.calc.Calcula'
```

### 2.2. Construcció i execució del projecte

Una vegada hem vist l'esquelet del projece, podem construir-lo amb l'ordre gradle build, des de la carpeta principal del projecte:

```
$ gradle build
```

BUILD SUCCESSFUL in 20s
7 actionable tasks: 7 executed

Amb açò, compila, processa els recursos i genera les classes i l'empaquetat jar de l'aplicació. Si ens fixem, tenim una nova carpeta build amb el resultat de la construcció del paquet:


```
diec85@diec85-PL62-7RC:~/Escritorio/Visual_Studio/EDD/TEMA 4/Java/gradle$ tree projecte/

projecte/
├── build
│   ├── classes
│   │   └── java
│   │       ├── main
│   │       │   └── com
│   │       │       └── ieseljust
│   │       │           └── edd
│   │       │               ├── App.class
│   │       │               └── calc
│   │       │                   ├── Calcula.class
│   │       │                   └── Calculadora.class
│   │       └── test
│   │           └── com
│   │               └── ieseljust
│   │                   └── edd
│   │                       └── AppTest.class
│   ├── distributions
│   │   ├── helloGradle.tar
│   │   └── helloGradle.zip
│   ├── libs
│   │   └── helloGradle.jar
│   ├── reports
│   │   └── tests
│   │       └── test
│   │           ├── classes
│   │           │   └── com.ieseljust.edd.AppTest.html
│   │           ├── css
│   │           │   ├── base-style.css
│   │           │   └── style.css
│   │           ├── index.html
│   │           ├── js
│   │           │   └── report.js
│   │           └── packages
│   │               └── com.ieseljust.edd.html
│   ├── scripts
│   │   ├── helloGradle
│   │   └── helloGradle.bat
│   ├── test-results
│   │   └── test
│   │       ├── binary
│   │       │   ├── output.bin
│   │       │   ├── output.bin.idx
│   │       │   └── results.bin
│   │       └── TEST-com.ieseljust.edd.AppTest.xml
│   └── tmp
│       ├── compileJava
│       ├── compileTestJava
│       └── jar
│           └── MANIFEST.MF
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
├── settings.gradle
└── src
    ├── main
    │   ├── java
    │   │   └── com
    │   │       └── ieseljust
    │   │           └── edd
    │   │               ├── App.java
    │   │               └── calc
    │   │                   ├── Calculadora.java
    │   │                   └── Calcula.java
    │   └── resources
    └── test
        ├── java
        │   └── com
        │       └── ieseljust
        │           └── edd
        │               └── AppTest.java
        └── resources
```

Si volem veure les diferents fases per les que passa la construcció de l'aplicació, podem utilitzar l'opció -i de Gradle: gradle build -i.

Per altra banda, si volem netejar el projecte i tornar a la configuració anterior, farem:

```
$ gradle clean
```

Finalment, per tal d'executar l'aplicació, només haure d'invocar gradle run i passar-li dos numeros. Es fara d'aquesta manera:


```
$ gradle run --args "20 30"
```

```
diec85@diec85-PL62-7RC:~/Escritorio/Visual_Studio/EDD/TEMA 4/Java/gradle/projecte$ gradle run --args "20 30"

> Task :run
La suma entre 20.0 i 30.0 és 50.0
La resta entre 20.0 i 30.0 és -10.0
La multiplicació entre 20.0 i 30.0 és 600.0
La divisió entre 20.0 i 30.0 és 0.6666667
Última operació realitzada: Divideix; Últim resultat: 0.6666667
La mitja de les operacions es: 35.0
Es 20.0 major que 30.0? false
Es 20.0 menor que 30.0? true

BUILD SUCCESSFUL in 0s
2 actionable tasks: 1 executed, 1 up-to-date
```
